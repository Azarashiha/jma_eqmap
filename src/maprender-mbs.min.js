mapboxgl.accessToken="pk.eyJ1IjoiYXphcmFzaGkiLCJhIjoiY2t0YmdibXczMXZwbzJubzBnZHI4Ym4zMCJ9.1C3RNiQqSioL1NkDSFE5Xg";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/azarashi/cktbgkxip5jml17n06wvzmgj9",center:[139.7670516,35.6811673],zoom:7,projection:"globe",customAttribution:['<a href="https://www.jma.go.jp/jma/index.html">震度情報:©︎気象庁</a>','<a href="https://nlftp.mlit.go.jp/index.html">国土数値情報:©︎国土交通省</a>','<a href="https://twitter.com/nyaonearthquake?s=21">編集:©︎nyaonearthquake</a>']}),citydata;map.addControl(new mapboxgl.NavigationControl);var popup=new mapboxgl.Popup({closeButton:!0});let switchBtn=document.getElementsByTagName("button")[0],box=document.getElementById("box"),changeElement=el=>{""==el.style.display?el.style.display="none":el.style.display=""};var url="jma_area.json";$.getJSON(url,(function(data){areadata=data}));var url="jma_city.json";$.getJSON(url,(function(data){citydata=data})),map.on("load",(function(){map.addControl(new mapboxgl.Minimap({center:[139.7670516,35.6811673],style:"mapbox://styles/azarashi/cladgnrdz000315qmj9d3q6iu",zoom:2,zoomLevels:[]}),"bottom-left")}));var mobile=$(window).width()<540;map.on("load",(function(){console.log("areaデータの数 "+areadata.features.length),console.log("cityデータの数 "+citydata.features.length),console.log(areadata.features[0].geometry.coordinates[0]),imgfile="image",map.loadImage(`${imgfile}/epicenter.png`,(error,image)=>{if(error)throw error;map.hasImage("epicenter")||map.addImage("epicenter",image)}),map.loadImage(`${imgfile}/int1.png`,(error,image)=>{if(error)throw error;map.hasImage("1")||map.addImage("1",image)}),map.loadImage(`${imgfile}/int2.png`,(error,image)=>{if(error)throw error;map.hasImage("2")||map.addImage("2",image)}),map.loadImage(`${imgfile}/int3.png`,(error,image)=>{if(error)throw error;map.hasImage("3")||map.addImage("3",image)}),map.loadImage(`${imgfile}/int4.png`,(error,image)=>{if(error)throw error;map.hasImage("4")||map.addImage("4",image)}),map.loadImage(`${imgfile}/int5l.png`,(error,image)=>{if(error)throw error;map.hasImage("5-")||map.addImage("5-",image)}),map.loadImage(`${imgfile}/int5h.png`,(error,image)=>{if(error)throw error;map.hasImage("5+")||map.addImage("5+",image)}),map.loadImage(`${imgfile}/int6l.png`,(error,image)=>{if(error)throw error;map.hasImage("6-")||map.addImage("6-",image)}),map.loadImage(`${imgfile}/int6h.png`,(error,image)=>{if(error)throw error;map.hasImage("6+")||map.addImage("6+",image)}),map.loadImage(`${imgfile}/int7.png`,(error,image)=>{if(error)throw error;map.hasImage("7")||map.addImage("7",image)}),map.addSource("data",{type:"geojson",data:areadata,maxzoom:10}),map.addSource("vt",{promoteId:"N03_007",type:"vector",tiles:["https://azarashiha.github.io/vt/{z}/{x}/{y}.pbf"]});for(const feature of citydata.features){const id=feature.properties.code,c=feature.properties.class;map.setFeatureState({source:"vt",sourceLayer:"city",id:id},{class:c})}map.addLayer({id:"pref-line",type:"fill",source:"vt","source-layer":"city",paint:{"fill-color":["match",["feature-state","class"],"1","rgba(171,223,244,0.7)","2","rgba(115,189,105,0.7)","3","rgba(227,227,80,0.7)","4","rgba(249,162,65,0.7)","5-","rgba(239,57,59,0.7)","5+","rgba(239,57,59,0.7)","6-","rgba(161,23,23,0.7)","6+","rgba(161,23,23,0.7)","7","rgba(56,1,13,0.7)","rgba(128,128,128,0.2)"],"fill-opacity":.9,"fill-outline-color":"rgba(82,82,82, 0.4)"}}),map.addLayer({id:"epicenter",type:"symbol",source:"data",filter:["==","class","epicenter"],layout:{"icon-image":"epicenter","icon-allow-overlap":!0,"icon-size":1.5}});for(const feature of areadata.features){const symbol=feature.properties.class,layerID=`${symbol}`;map.getLayer(layerID)||(console.log(layerID),map.addLayer({id:`${layerID}`,type:"symbol",source:"data",filter:["==","class",symbol],layout:{"icon-image":`${symbol}`,"icon-allow-overlap":!0,"icon-size":.5}}))}function addpoint(){let array=[];for(let i=0;i<=areadata.features.length;i++){let j=areadata.features[i].geometry.coordinates;if(array.push(j),i==areadata.features.length-1)return array}}console.log(areadata.features.length);var line=turf.lineString(addpoint()),bbox=turf.bbox(line);areadata.features.length>7?(map.fitBounds(bbox,{padding:100,animate:!1}),console.log("7以上")):areadata.features.length>4?(map.fitBounds(bbox,{padding:250,animate:!1}),console.log("4以上")):(map.fitBounds(bbox,{padding:360,animate:!1}),console.log("else"));for(var Map_AddLayer={epicenter:"震源地",7:"震度7","6+":"震度6強","6-":"震度6弱","5+":"震度5強","5-":"震度5弱",4:"震度4",3:"震度3",2:"震度2",1:"震度1"},i=0;i<Object.keys(Map_AddLayer).length;i++){var id=Object.keys(Map_AddLayer)[i],link=document.createElement("a");link.href="#",link.id=id,link.textContent=Map_AddLayer[id],link.className="active",link.onclick=function(e){var clickedLayer=this.id,visibility;e.preventDefault(),e.stopPropagation(),"visible"===map.getLayoutProperty(clickedLayer,"visibility")?(map.setLayoutProperty(clickedLayer,"visibility","none"),this.className=""):(map.setLayoutProperty(clickedLayer,"visibility","visible"),this.className="active")}}})),map.on("mousemove",e=>{var features=map.queryRenderedFeatures(e.point);const displayProperties=["type","properties","id","layer","source","sourceLayer","state"],displayFeatures=features.map(feat=>{const displayFeat={};return displayProperties.forEach(prop=>{displayFeat[prop]=feat[prop]}),displayFeat});document.getElementById("features").innerHTML=JSON.stringify(displayFeatures,null,2)});